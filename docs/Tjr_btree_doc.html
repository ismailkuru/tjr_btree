<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Test_string_int_on_fd.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Test" rel="Chapter" href="Test.html">
<link title="Tjr_string" rel="Chapter" href="Tjr_string.html">
<link title="Pickle" rel="Chapter" href="Pickle.html">
<link title="Bt_constants" rel="Chapter" href="Bt_constants.html">
<link title="Bt_monad" rel="Chapter" href="Bt_monad.html">
<link title="Isa_export" rel="Chapter" href="Isa_export.html">
<link title="Pickle_params" rel="Chapter" href="Pickle_params.html">
<link title="Frame" rel="Chapter" href="Frame.html">
<link title="Bt_tree" rel="Chapter" href="Bt_tree.html">
<link title="Base_types_pervasives" rel="Chapter" href="Base_types_pervasives.html">
<link title="R2t" rel="Chapter" href="R2t.html">
<link title="Store_ops" rel="Chapter" href="Store_ops.html">
<link title="Bt_params" rel="Chapter" href="Bt_params.html">
<link title="Base_types" rel="Chapter" href="Base_types.html">
<link title="Bt_small_step" rel="Chapter" href="Bt_small_step.html">
<link title="Config" rel="Chapter" href="Config.html">
<link title="Prelude_pervasives" rel="Chapter" href="Prelude_pervasives.html">
<link title="Prelude" rel="Chapter" href="Prelude.html">
<link title="Default" rel="Chapter" href="Default.html">
<link title="Btree_api" rel="Chapter" href="Btree_api.html">
<link title="Iter_leaf_stream" rel="Chapter" href="Iter_leaf_stream.html">
<link title="Pre_map_ops" rel="Chapter" href="Pre_map_ops.html">
<link title="Iter_with_check" rel="Chapter" href="Iter_with_check.html">
<link title="Store_to_map" rel="Chapter" href="Store_to_map.html">
<link title="Btree_with_pickle" rel="Chapter" href="Btree_with_pickle.html">
<link title="Disk_on_fd" rel="Chapter" href="Disk_on_fd.html">
<link title="Disk_to_store" rel="Chapter" href="Disk_to_store.html">
<link title="Mem_store" rel="Chapter" href="Mem_store.html">
<link title="Recycling_store" rel="Chapter" href="Recycling_store.html">
<link title="Digest_" rel="Chapter" href="Digest_.html">
<link title="Small_string" rel="Chapter" href="Small_string.html">
<link title="Todo_map_idx_blk" rel="Chapter" href="Todo_map_idx_blk.html">
<link title="Example_keys_and_values" rel="Chapter" href="Example_keys_and_values.html">
<link title="Cache" rel="Chapter" href="Cache.html">
<link title="Bytestore" rel="Chapter" href="Bytestore.html">
<link title="Map_on_fd" rel="Chapter" href="Map_on_fd.html">
<link title="Mem_map" rel="Chapter" href="Mem_map.html">
<link title="Ss_int_map_on_fd" rel="Chapter" href="Ss_int_map_on_fd.html">
<link title="Ss_ss_map_on_fd" rel="Chapter" href="Ss_ss_map_on_fd.html">
<link title="Int_int_map_on_fd" rel="Chapter" href="Int_int_map_on_fd.html">
<link title="Exhaustive" rel="Chapter" href="Exhaustive.html">
<link title="Test_bytestore" rel="Chapter" href="Test_bytestore.html">
<link title="Test_cache" rel="Chapter" href="Test_cache.html">
<link title="Test_common" rel="Chapter" href="Test_common.html">
<link title="Test_config" rel="Chapter" href="Test_config.html">
<link title="Test_int_int_on_fd" rel="Chapter" href="Test_int_int_on_fd.html">
<link title="Test_mem_map" rel="Chapter" href="Test_mem_map.html">
<link title="Test_sh" rel="Chapter" href="Test_sh.html">
<link title="Test_string_int_on_fd" rel="Chapter" href="Test_string_int_on_fd.html">
<link title="Tjr_btree_doc" rel="Chapter" href="Tjr_btree_doc.html"><title>Tjr_btree_doc</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Test_string_int_on_fd.html" title="Test_string_int_on_fd">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;</div>
<h1>Module <a href="type_Tjr_btree_doc.html">Tjr_btree_doc</a></h1>

<pre><span class="keyword">module</span> Tjr_btree_doc: <code class="code">sig</code> <a href="Tjr_btree_doc.html">..</a> <code class="code">end</code></pre><div class="info module top">
tjr_btree, a COW B-tree in OCaml (documentation)<br>
</div>
<hr width="100%">

<pre><span id="VALdummy"><span class="keyword">val</span> dummy</span> : <code class="type">int</code></pre><div class="info ">
General documentation and overview
<p>

<h1 id="1_Introduction">Introduction</h1>
<p>

This library implements a B-tree in OCaml. The source is actually
   exported from Isabelle, and then OCaml code wraps the
   Isabelle-generated code.
<p>

The code is organized into subdirectories (subpackages), and the
   subdirectories are in a linear order (which corresponds to the
   dependencies between modules).
<p>

This document gives an overview of the (sub)packages. Detailed
   comments are included in the individual modules.
<p>

<h1 id="1_Guidetothecode">Guide to the code</h1>
<p>

<h2 id="2_Namingconventions">Naming conventions</h2>
<p>

To understand the interfaces, we need to introduce the following:
<p>
<ul>
<li>Keys, represented by type variable <code class="code">'k</code> </li>
<li>Values, by type var <code class="code">'v</code> </li>
<li>Page/block references, <code class="code">'r</code> </li>
<li>Global state, <code class="code">'t</code></li>
</ul>

<h2 id="2_ExportedcodefromIsabelle">Exported code from Isabelle</h2>
<p>

Exported code is in the <code class="code">from_isa</code> package. There is some patching of
   the Isabelle-exported code before it is copied to <code class="code">base_types</code> in
   module <a href="Isa_export.html"><code class="code">Isa_export</code></a>. Hopefully this code is relatively stable. It
   certainly isn't readable.
<p>

<h2 id="2_Pickle">Pickle</h2>
<p>

The marshalling and pickling routines are in the <code class="code">pickle</code> package. See
   module <a href="Pickle.html"><code class="code">Pickle</code></a>. We also include a utility library for strings
   <a href="Tjr_string.html"><code class="code">Tjr_string</code></a>, and a few functions to deal with logging and testing
   in <a href="Test.html"><code class="code">Test</code></a>.
<p>

<h2 id="2_Basetypes">Base types</h2>
<p>

This package contains basic B-tree related types. They are collected
   in the module <a href="Base_types.html"><code class="code">Base_types</code></a>. The <a href="Base_types.Monad.html"><code class="code">Base_types.Monad</code></a> is a
   state-passing monad with error; this monad shows up in most of the
   interfaces. <a href="Store_ops.html"><code class="code">Store_ops</code></a> is another important module which
   describes a disk-like interface on top of which we implement the
   B-tree. The <a href="Base_types.Tree.html"><code class="code">Base_types.Tree</code></a> module describes a B-tree as an
   algebraic datatype. The on-disk B-tree uses references between
   blocks i.e. a graph-like structure with pointers rather than a
   datatype. Indeed, the tree datatype is used only for testing
   purposes.
<p>

<h2 id="2_Prelude">Prelude</h2>
<p>

Miscellaneous definitions. <a href="Prelude.Small_step.html"><code class="code">Prelude.Small_step</code></a> wraps the Isabelle
   small-step definitions.
<p>

<h2 id="2_Api">Api</h2>
<p>

<a href="Btree_api.html"><code class="code">Btree_api</code></a> gives the main interface types, including interfaces for
   disk, store and map (via record types such as <code class="code">map_ops</code>). In
   addition, the leaf stream interface allows to iterate over the
   leaves in a B-tree e.g. to find all the bindings in the map. This
   module also documents the type variable naming conventions.
<p>

<a href="Default.html"><code class="code">Default</code></a> is a simple collection of defaults eg default block size.
<p>

<h2 id="2_Storetomap">Store to map</h2>
<p>

This package, particularly the <a href="Store_to_map.html"><code class="code">Store_to_map</code></a> module, wraps the
   Isabelle routines to implement a map interface on top of a
   store. The key function is <a href="Store_to_map.html#VALmake_map_ops"><code class="code">Store_to_map.make_map_ops</code></a> which takes
   a <code class="code">store_ops</code> and returns a <code class="code">map_ops</code>.
<p>

<h2 id="2_Disks">Disks</h2>
<p>

<a href="Disk_on_fd.html"><code class="code">Disk_on_fd</code></a> is a persistent disk on top of a file. <a href="Disk_to_store.html"><code class="code">Disk_to_store</code></a>
   includes a function that naively transforms a disk to a store. This
   involves converting a <a href="Frame.html"><code class="code">Frame</code></a> to a block, using
   <a href="Btree_with_pickle.html"><code class="code">Btree_with_pickle</code></a> TODO rename.
<p>

<h2 id="2_Stores">Stores</h2>
<p>

<a href="Mem_store.html"><code class="code">Mem_store</code></a> is an in-memory store. <a href="Recycling_store.html"><code class="code">Recycling_store</code></a> is a store that
   optimizes page alloc and free to avoid too many unnecessary writes.
<p>

<h2 id="2_Preexamples">Pre examples</h2>
<p>

This package contains various modules needed by the examples, such as
   <a href="Small_string.html"><code class="code">Small_string</code></a> which implements strings upto 256 bytes (used for
   keys in the B-tree).
<p>

<h2 id="2_Cache">Cache</h2>
<p>

A generic LRU <a href="Cache.html"><code class="code">Cache</code></a> on top of a map.
<p>

<h2 id="2_Examples">Examples</h2>
<p>

Various examples. <a href="Ss_ss_map_on_fd.html"><code class="code">Ss_ss_map_on_fd</code></a> implements an on-disk map from
   (small) string to string. <a href="Int_int_map_on_fd.html"><code class="code">Int_int_map_on_fd</code></a> and
   <a href="Ss_int_map_on_fd.html"><code class="code">Ss_int_map_on_fd</code></a> are similar. <a href="Map_on_fd.html"><code class="code">Map_on_fd</code></a> is the generic
   version and <a href="Mem_map.html"><code class="code">Mem_map</code></a> is a map on top of the
   <a href="Mem_store.html"><code class="code">Mem_store</code></a>. <a href="Bytestore.html"><code class="code">Bytestore</code></a> is TODO and should implement arbitrary
   long values.
<p>

<h2 id="2_Testing">Testing</h2>
<p>

Various tests.
<p>

<h2 id="2_Main">Main</h2>
<p>

These <code class="code">xxx.ml</code> files get turned into executables
   <code class="code">xxx.native</code>. <code class="code">main.native</code> is used by the <code class="code">kv_main.sh</code> example;
   <code class="code">test_main.native</code> is used for testing; <code class="code">simple_example.native</code> is
   the simple example.<br>
</div>
</body></html>